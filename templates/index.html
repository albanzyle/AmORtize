<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knapsack Neural Network Solver - Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 30px;
        }

        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .panel h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .items-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: white;
        }

        .item {
            display: grid;
            grid-template-columns: 40px 1fr 1fr 80px;
            gap: 10px;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            transition: background 0.2s;
        }

        .item:hover {
            background: #f8f9fa;
        }

        .item.selected {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .item.optimal {
            background: #cce5ff;
            border-left: 4px solid #007bff;
        }

        .item.both {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .item-id {
            font-weight: bold;
            color: #667eea;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .stat-card.success {
            border-left-color: #28a745;
        }

        .stat-card.warning {
            border-left-color: #ffc107;
        }

        .stat-card.info {
            border-left-color: #17a2b8;
        }

        .comparison {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .comparison h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .comparison-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .comparison-row:last-child {
            border-bottom: none;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 600;
        }

        .legend {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }

        .chart-container {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎒 Knapsack Neural Network Solver</h1>
            <p>AI-powered optimization vs Traditional Dynamic Programming</p>
        </header>

        <div class="main-content">
            <!-- Left Panel: Problem Setup -->
            <div class="panel">
                <h2>📦 Problem Setup</h2>
                
                <div class="form-group">
                    <label for="numItems">Number of Items (5-20000):</label>
                    <input type="number" id="numItems" value="30" min="5" max="20000">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="capacityRatio">Capacity Ratio:</label>
                        <select id="capacityRatio">
                            <option value="0.3">Tight (30%)</option>
                            <option value="0.5" selected>Balanced (50%)</option>
                            <option value="0.7">Loose (70%)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="seed">Random Seed:</label>
                        <input type="number" id="seed" placeholder="Random">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="useLocalSearch" checked>
                    <label for="useLocalSearch">Enable 2-Swap Local Search</label>
                </div>

                <button class="btn btn-primary" onclick="generateProblem()">
                    🎲 Generate Problem
                </button>

                <button class="btn btn-secondary" onclick="solveProblem()" id="solveBtn" disabled>
                    ⚡ Solve with AI + DP
                </button>

                <!-- Problem Info -->
                <div id="problemInfo" style="display: none; margin-top: 20px;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Total Items</h3>
                            <div class="value" id="totalItems">-</div>
                        </div>
                        <div class="stat-card info">
                            <h3>Capacity</h3>
                            <div class="value" id="capacity">-</div>
                        </div>
                        <div class="stat-card warning">
                            <h3>Total Value</h3>
                            <div class="value" id="totalValue">-</div>
                        </div>
                        <div class="stat-card">
                            <h3>Total Weight</h3>
                            <div class="value" id="totalWeight">-</div>
                        </div>
                    </div>
                </div>

                <!-- Items List -->
                <div id="itemsContainer" class="items-container" style="display: none;">
                    <h3 style="margin-bottom: 10px;">Items:</h3>
                    <div id="itemsList"></div>
                </div>
            </div>

            <!-- Right Panel: Results -->
            <div class="panel">
                <h2>📊 Results</h2>
                
                <div id="resultsPlaceholder" style="text-align: center; padding: 50px; color: #999;">
                    <p>Generate a problem and click "Solve" to see results</p>
                </div>

                <div id="resultsContainer" style="display: none;">
                    <!-- Comparison Summary -->
                    <div class="comparison">
                        <h3>⚖️ Performance Comparison</h3>
                        <div class="comparison-row">
                            <span>Optimality Gap:</span>
                            <strong id="gapPercent">-</strong>
                        </div>
                        <div class="comparison-row">
                            <span>Speed Improvement:</span>
                            <strong id="speedup">-</strong>
                        </div>
                        <div class="comparison-row">
                            <span>Value Difference:</span>
                            <strong id="valueDiff">-</strong>
                        </div>
                    </div>

                    <!-- Neural Network Solution -->
                    <div class="chart-container">
                        <h3>🤖 Neural Network Solution</h3>
                        <div class="stats-grid">
                            <div class="stat-card success">
                                <h3>Total Value</h3>
                                <div class="value" id="nnValue">-</div>
                            </div>
                            <div class="stat-card">
                                <h3>Items Selected</h3>
                                <div class="value" id="nnSelected">-</div>
                            </div>
                            <div class="stat-card info">
                                <h3>Weight Used</h3>
                                <div class="value" id="nnWeight">-</div>
                            </div>
                            <div class="stat-card warning">
                                <h3>Time</h3>
                                <div class="value" id="nnTime">-</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="nnProgress" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <!-- Optimal Solution -->
                    <div class="chart-container">
                        <h3>🎯 Optimal DP Solution</h3>
                        <div class="stats-grid">
                            <div class="stat-card success">
                                <h3>Total Value</h3>
                                <div class="value" id="optValue">-</div>
                            </div>
                            <div class="stat-card">
                                <h3>Items Selected</h3>
                                <div class="value" id="optSelected">-</div>
                            </div>
                            <div class="stat-card info">
                                <h3>Weight Used</h3>
                                <div class="value" id="optWeight">-</div>
                            </div>
                            <div class="stat-card warning">
                                <h3>Time</h3>
                                <div class="value" id="optTime">-</div>
                            </div>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="optProgress" style="width: 0%">0%</div>
                        </div>
                    </div>

                    <!-- Legend -->
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #d4edda;"></div>
                            <span>NN Selected</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #cce5ff;"></div>
                            <span>DP Selected</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fff3cd;"></div>
                            <span>Both Selected</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentProblem = null;

        async function generateProblem() {
            const numItems = parseInt(document.getElementById('numItems').value);
            const capacityRatio = parseFloat(document.getElementById('capacityRatio').value);
            const seedInput = document.getElementById('seed').value;
            const seed = seedInput ? parseInt(seedInput) : Math.floor(Math.random() * 100000);

            // Validation
            if (isNaN(numItems) || numItems < 5 || numItems > 20000) {
                alert('Please enter a valid number of items (5-20000)');
                return;
            }

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({n_items: numItems, capacity_ratio: capacityRatio, seed: seed})
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to generate problem');
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                currentProblem = data;

                // Update problem info
                document.getElementById('totalItems').textContent = data.n_items;
                document.getElementById('capacity').textContent = data.capacity;
                document.getElementById('totalValue').textContent = data.total_value;
                document.getElementById('totalWeight').textContent = data.total_weight;
                document.getElementById('problemInfo').style.display = 'block';

                // Display items
                const itemsList = document.getElementById('itemsList');
                itemsList.innerHTML = data.items.map(item => `
                    <div class="item" id="item-${item.id}">
                        <div class="item-id">#${item.id}</div>
                        <div>Value: ${item.value}</div>
                        <div>Weight: ${item.weight}</div>
                        <div>Ratio: ${item.ratio.toFixed(2)}</div>
                    </div>
                `).join('');
                document.getElementById('itemsContainer').style.display = 'block';

                // Enable solve button
                document.getElementById('solveBtn').disabled = false;

                // Hide previous results
                document.getElementById('resultsContainer').style.display = 'none';
                document.getElementById('resultsPlaceholder').style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                alert('Error generating problem: ' + error.message);
            }
        }

        async function solveProblem() {
            if (!currentProblem) {
                alert('Please generate a problem first');
                return;
            }

            const useLocalSearch = document.getElementById('useLocalSearch').checked;

            try {
                document.getElementById('resultsPlaceholder').innerHTML = '<div class="loading">⏳ Solving...</div>';

                const response = await fetch('/api/solve', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        items: currentProblem.items,
                        capacity: currentProblem.capacity,
                        use_local_search: useLocalSearch
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to solve problem');
                }

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }

                // Update comparison
                document.getElementById('gapPercent').innerHTML = 
                    `<span class="badge ${data.comparison.gap_percent < 1 ? 'badge-success' : 'badge-warning'}">${data.comparison.gap_percent}%</span>`;
                document.getElementById('speedup').innerHTML = 
                    `<span class="badge badge-info">${data.comparison.speedup}x faster</span>`;
                document.getElementById('valueDiff').textContent = 
                    data.comparison.value_difference === 0 ? 'Optimal! ✓' : `-${data.comparison.value_difference}`;

                // Update NN stats
                document.getElementById('nnValue').textContent = data.nn_solution.total_value;
                document.getElementById('nnSelected').textContent = `${data.nn_solution.n_selected}/${currentProblem.n_items}`;
                document.getElementById('nnWeight').textContent = `${data.nn_solution.total_weight}/${currentProblem.capacity}`;
                document.getElementById('nnTime').textContent = `${data.nn_solution.time_ms}ms`;
                const nnPercent = (data.nn_solution.total_weight / currentProblem.capacity * 100).toFixed(1);
                document.getElementById('nnProgress').style.width = `${nnPercent}%`;
                document.getElementById('nnProgress').textContent = `${nnPercent}%`;

                // Update Opt stats
                document.getElementById('optValue').textContent = data.optimal_solution.total_value;
                document.getElementById('optSelected').textContent = `${data.optimal_solution.n_selected}/${currentProblem.n_items}`;
                document.getElementById('optWeight').textContent = `${data.optimal_solution.total_weight}/${currentProblem.capacity}`;
                document.getElementById('optTime').textContent = `${data.optimal_solution.time_ms}ms`;
                const optPercent = (data.optimal_solution.total_weight / currentProblem.capacity * 100).toFixed(1);
                document.getElementById('optProgress').style.width = `${optPercent}%`;
                document.getElementById('optProgress').textContent = `${optPercent}%`;

                // Highlight selected items
                currentProblem.items.forEach(item => {
                    const itemDiv = document.getElementById(`item-${item.id}`);
                    itemDiv.className = 'item';
                    
                    const nnSelected = data.nn_solution.selected_items.includes(item.id);
                    const optSelected = data.optimal_solution.selected_items.includes(item.id);
                    
                    if (nnSelected && optSelected) {
                        itemDiv.classList.add('both');
                    } else if (nnSelected) {
                        itemDiv.classList.add('selected');
                    } else if (optSelected) {
                        itemDiv.classList.add('optimal');
                    }
                });

                // Show results
                document.getElementById('resultsPlaceholder').style.display = 'none';
                document.getElementById('resultsContainer').style.display = 'block';

            } catch (error) {
                console.error('Error:', error);
                alert('Error solving problem: ' + error.message);
                document.getElementById('resultsPlaceholder').innerHTML = '<p style="color: red;">Error: ' + error.message + '</p>';
            }
        }

        // Initialize with a problem on load
        window.onload = function() {
            console.log('Knapsack NN Demo loaded');
        };
    </script>
</body>
</html>
